# Accounting Application

## Overview

This is a full-stack accounting application built with React on the frontend and Express.js on the backend. The application provides comprehensive accounting functionality including chart of accounts management, journal entries, invoicing, and financial reporting. It's designed for small to medium businesses with multi-company support and role-based access control.

## System Architecture

### Frontend Architecture
- **Framework**: React with TypeScript
- **Routing**: Wouter for client-side routing
- **State Management**: TanStack Query (React Query) for server state management
- **UI Components**: Shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **Forms**: React Hook Form with Zod validation
- **Build Tool**: Vite for development and production builds

### Backend Architecture
- **Framework**: Express.js with TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Database Provider**: Neon Database (serverless PostgreSQL)
- **Authentication**: Session-based authentication with bcrypt for password hashing
- **Session Storage**: Express sessions with PostgreSQL store
- **API Design**: RESTful API endpoints with JSON responses

### Project Structure
- `client/` - React frontend application
- `server/` - Express.js backend application
- `shared/` - Shared TypeScript schemas and types
- `migrations/` - Database migration files (generated by Drizzle)

## Key Components

### Authentication System
- Session-based authentication using express-session
- Password hashing with bcrypt
- User registration and login functionality
- Company switching for multi-tenant support
- Role-based access control (administrator, manager, accountant, assistant)

### Database Schema
The application uses a comprehensive accounting database schema including:
- **Users**: User accounts with authentication
- **Companies**: Multi-company support with company-specific data
- **User-Company Relationships**: Role-based access per company
- **Chart of Accounts**: Hierarchical account structure
- **Journal Entries**: Double-entry bookkeeping transactions
- **Customers & Vendors**: Contact management
- **Invoices & Bills**: Transaction documents

### Frontend Pages
- **Dashboard**: Overview with key metrics and recent transactions
- **Chart of Accounts**: Account management with hierarchical structure
- **General Ledger**: Transaction history and account balances
- **Journal Entries**: Manual transaction entry with double-entry validation
- **Invoices**: Customer billing management
- **Financial Statements**: Profit & Loss, Balance Sheet reporting
- **User Management**: Multi-company user and role administration

### UI Components
- Comprehensive component library using Shadcn/ui
- Responsive design with mobile support
- Dark/light theme support via CSS variables
- Form validation with real-time feedback
- Data tables with sorting and filtering
- Modal dialogs for data entry and editing

## Data Flow

### Authentication Flow
1. User submits login credentials
2. Server validates credentials against database
3. Session is created and stored in PostgreSQL
4. User data and available companies are returned
5. Frontend stores authentication state in React Query

### Transaction Flow
1. User creates journal entry through form
2. Frontend validates data using Zod schemas
3. API request sent to backend with transaction data
4. Backend validates and stores transaction in database
5. Frontend updates local cache and shows success feedback

### Multi-Company Flow
1. User selects company from dropdown
2. Company switch request sent to backend
3. Session updated with current company ID
4. All subsequent API requests are scoped to selected company
5. Frontend re-fetches company-specific data

## External Dependencies

### Backend Dependencies
- **@neondatabase/serverless**: Neon database connection
- **drizzle-orm**: Type-safe ORM for PostgreSQL
- **bcrypt**: Password hashing
- **express-session**: Session management
- **connect-pg-simple**: PostgreSQL session store

### Frontend Dependencies
- **@tanstack/react-query**: Server state management
- **@radix-ui/***: Accessible UI primitives
- **react-hook-form**: Form handling
- **@hookform/resolvers**: Form validation
- **zod**: Schema validation
- **wouter**: Lightweight routing
- **date-fns**: Date manipulation
- **tailwindcss**: Utility-first CSS framework

### Development Dependencies
- **tsx**: TypeScript execution for development
- **esbuild**: Fast bundler for production
- **vite**: Development server and build tool
- **drizzle-kit**: Database migration tool

## Deployment Strategy

### Development Environment
- Uses Vite development server with HMR
- Express server runs on port 5000
- PostgreSQL database provided by Replit
- Session-based development workflow

### Production Build
- Frontend built using Vite to static assets
- Backend bundled using esbuild for Node.js
- Static assets served from Express server
- Database migrations applied using Drizzle Kit

### Environment Configuration
- Database connection via DATABASE_URL environment variable
- Session secret configurable via SESSION_SECRET
- Production/development mode detection
- Replit-specific optimizations for cloud deployment

## Role-Based Access Control System

### Access Levels

The application implements four distinct access levels with hierarchical permissions:

#### 1. Assistant Accountant
- **Purpose**: Data entry and basic operations
- **Permissions**: View dashboard, create customers/vendors, basic journal entries, view invoices/bills, basic reporting
- **Restrictions**: Cannot modify chart of accounts, delete records, or access settings

#### 2. Accountant  
- **Purpose**: Full accounting operations
- **Permissions**: All assistant permissions plus account management, journal posting/unposting, invoice sending, bill payments, report exports
- **Restrictions**: Cannot manage users, companies, or system settings

#### 3. Manager
- **Purpose**: Company management and full accounting
- **Permissions**: All accountant permissions plus user management within company, company settings, custom reports, account/record deletion
- **Restrictions**: Cannot create new companies or manage system-wide users

#### 4. Administrator
- **Purpose**: Full system access
- **Permissions**: All manager permissions plus company creation, system-wide user management, complete access across all companies
- **Restrictions**: None

### Permission Enforcement

- **Navigation**: Menu items are dynamically filtered based on user permissions
- **API**: All endpoints validate user roles and company access
- **UI**: Create/edit/delete buttons are conditionally rendered based on permissions
- **Company Isolation**: All data is scoped to the selected company except for administrators

### Role Assignment Rules

- Administrators can assign any role to any user
- Managers can assign Assistant and Accountant roles only
- Accountants and Assistants cannot assign roles
- Users can belong to multiple companies with different roles per company

## Changelog

```
Changelog:
- June 19, 2025. Initial setup
- June 19, 2025. Implemented comprehensive role-based access control system with four access levels
```

## User Preferences

Preferred communication style: Simple, everyday language.